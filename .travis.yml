language: go

sudo: required

go:
- 1.13.x

arch: ppc64le

os: linux

script: 
- sudo mkdir -p /var/www/beta.restic.net/
- sudo chmod 777 /var/www/beta.restic.net/
- mkdir -p "$HOME"/go-workspace
- mkdir -p "$HOME"/go-workspace/bin
- mkdir -p "$HOME"/go-workspace/src
- mkdir -p "$HOME"/go-workspace/pkg
- PATH=$PATH:/usr/local/go/bin
- export PATH
- GOPATH=$HOME/go-workspace
- export GOPATH
- PATH=$PATH:$(go env GOPATH)/bin
- export PATH
- GOPATH=$(go env GOPATH)
- export GOPATH
- cd "$HOME"/go-workspace/src
- git clone https://github.com/restic/beta.git
- cd ./beta
# Add Power as part of the list of supported architectures
- sed '113i\                \{"linux", "ppc64le"},' main.go > main_ppc64le.go
- mv ./main_ppc64le.go ./main.go
- go build
- timeout 5m ./beta || echo "success"
- DIR_NAME=$(ls /var/www/beta.restic.net/)
- echo $DIR_NAME
- ls /var/www/beta.restic.net/restic*
# TODO: copy the content of /var/www/beta.restic.net/restic* to the FTP if the build completes with success.
